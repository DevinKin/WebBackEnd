
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>day27 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-toggle-chapters/toggle.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-multipart/multipart.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="day26.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../JavaWeb/javaweb.html">
            
                <a href="../JavaWeb/javaweb.html">
            
                    
                    JavaWeb
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../JavaWeb/day1.html">
            
                <a href="../JavaWeb/day1.html">
            
                    
                    day1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../JavaWeb/day2.html">
            
                <a href="../JavaWeb/day2.html">
            
                    
                    day2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../JavaWeb/day3.html">
            
                <a href="../JavaWeb/day3.html">
            
                    
                    day3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../JavaWeb/day4.html">
            
                <a href="../JavaWeb/day4.html">
            
                    
                    day4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../JavaWeb/day5.html">
            
                <a href="../JavaWeb/day5.html">
            
                    
                    day5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../JavaWeb/day6.html">
            
                <a href="../JavaWeb/day6.html">
            
                    
                    day6
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../JavaWeb/day7.html">
            
                <a href="../JavaWeb/day7.html">
            
                    
                    day7
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../JavaWeb/day8.html">
            
                <a href="../JavaWeb/day8.html">
            
                    
                    day8
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../JavaWeb/day9.html">
            
                <a href="../JavaWeb/day9.html">
            
                    
                    day9
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="../JavaWeb/day10.html">
            
                <a href="../JavaWeb/day10.html">
            
                    
                    day10
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="../JavaWeb/day11.html">
            
                <a href="../JavaWeb/day11.html">
            
                    
                    day11
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="../JavaWeb/day12.html">
            
                <a href="../JavaWeb/day12.html">
            
                    
                    day12
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.13" data-path="../JavaWeb/day13.html">
            
                <a href="../JavaWeb/day13.html">
            
                    
                    day13
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.14" data-path="../JavaWeb/day14.html">
            
                <a href="../JavaWeb/day14.html">
            
                    
                    day14
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.15" data-path="../JavaWeb/day15.html">
            
                <a href="../JavaWeb/day15.html">
            
                    
                    day15
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.16" data-path="../JavaWeb/day16.html">
            
                <a href="../JavaWeb/day16.html">
            
                    
                    day16
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.17" data-path="../JavaWeb/day17.html">
            
                <a href="../JavaWeb/day17.html">
            
                    
                    day17
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../Project/project.html">
            
                <a href="../Project/project.html">
            
                    
                    Project
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../Project/JavaWeb/JavaWeb.html">
            
                <a href="../Project/JavaWeb/JavaWeb.html">
            
                    
                    JavaWeb
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../Project/JavaWeb/latex.html">
            
                <a href="../Project/JavaWeb/latex.html">
            
                    
                    Latex
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="Oracle.html">
            
                <a href="Oracle.html">
            
                    
                    Oracle
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="day25.html">
            
                <a href="day25.html">
            
                    
                    day25
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="day26.html">
            
                <a href="day26.html">
            
                    
                    day26
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.3" data-path="day27.html">
            
                <a href="day27.html">
            
                    
                    day27
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >day27</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="plsql">PLSQL</h1>
<h2 id="&#x4EC0;&#x4E48;&#x662F;plsql">&#x4EC0;&#x4E48;&#x662F;PL/SQL</h2>
<ol>
<li>PL/SQL(Procedure Language/SQL)</li>
<li>PLSQL&#x662F;postgresplsql&#x5BF9;sql&#x8BED;&#x8A00;&#x7684;&#x8FC7;&#x7A0B;&#x5316;&#x6269;&#x5C55;&#xFF0C;&#x6307;&#x5728;SQL&#x547D;&#x4EE4;&#x8BED;&#x8A00;&#x4E2D;&#x589E;&#x52A0;&#x4E86;&#x8FC7;&#x7A0B;&#x5904;&#x7406;&#x8BED;&#x53E5;(&#x5982;&#x5206;&#x652F;&#xFF0C;&#x5FAA;&#x73AF;&#x7B49;)&#xFF0C;&#x4F7F;SQL&#x8BED;&#x8A00;&#x5177;&#x6709;&#x8FC7;&#x7A0B;&#x5904;&#x7406;&#x80FD;&#x529B;&#x4E0E;&#x8FC7;&#x7A0B;&#x8BED;&#x8A00;&#x7684;&#x6570;&#x636E;&#x5904;&#x7406;&#x80FD;&#x529B;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#xFF0C;&#x4F7F;&#x5F97;PLSQL&#x5728;&#x9762;&#x5411;&#x8FC7;&#x7A0B;&#x4F46;&#x6BD4;&#x8FC7;&#x7A0B;&#x8BED;&#x8A00;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x3001;&#x7075;&#x6D3B;&#x548C;&#x4F7F;&#x7528;&#x3002;</li>
</ol>
<h2 id="plsql&#x7A0B;&#x5E8F;&#x7ED3;&#x6784;">PL/SQL&#x7A0B;&#x5E8F;&#x7ED3;&#x6784;</h2>
<pre><code class="lang-postgresplsql">declare
    &#x8BF4;&#x660E;&#x90E8;&#x5206; (&#x53D8;&#x91CF;&#x8BF4;&#x660E;&#xFF0C;&#x5149;&#x6807;&#x7533;&#x660E;&#xFF0C;&#x4F8B;&#x5916;&#x8BF4;&#x660E;)
begin
    &#x8BED;&#x53E5;&#x5E8F;&#x5217; (DML&#x8BED;&#x53E5;)
exception
    &#x4F8B;&#x5916;&#x5904;&#x7406;&#x8BED;&#x53E5;
end;
</code></pre>
<h2 id="&#x8BF4;&#x660E;&#x90E8;&#x5206;">&#x8BF4;&#x660E;&#x90E8;&#x5206;</h2>
<h3 id="&#x53D8;&#x91CF;&#x548C;&#x5E38;&#x91CF;&#x8BF4;&#x660E;">&#x53D8;&#x91CF;&#x548C;&#x5E38;&#x91CF;&#x8BF4;&#x660E;</h3>
<ol>
<li><p>&#x8BF4;&#x660E;&#x53D8;&#x91CF;</p>
<ol>
<li>char</li>
<li>varchar2</li>
<li>date</li>
<li>number</li>
<li>boolean</li>
<li>long</li>
</ol>
</li>
<li><p>&#x4F8B;</p>
<pre><code class="lang-postgresplsql">---&#x8BF4;&#x660E;&#x53D8;&#x91CF;&#x540D;&#x3001;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x548C;&#x957F;&#x5EA6;&#x540E;&#x7528;&#x5206;&#x53F7;&#x7ED3;&#x675F;&#x8BF4;&#x660E;&#x8BED;&#x53E5;
var1 char(15);
married boolean := true;
psal number(7,2);
---&#x5F15;&#x7528;&#x578B;&#x53D8;&#x91CF;&#xFF0C;&#x5373;my_name&#x7684;&#x7C7B;&#x578B;&#x4E0E;emp&#x8868;&#x4E2D;ename&#x5217;&#x7684;&#x7C7B;&#x578B;&#x4E00;&#x81F4;
my_name emp.ename%type;
---&#x8BB0;&#x5F55;&#x578B;&#x53D8;&#x91CF;
emp_rec emp%rowtype;
</code></pre>
</li>
</ol>
<p>&#x5F15;&#x7528;&#x53D8;&#x91CF;&#x5B9E;&#x4F8B;</p>
<pre><code class="lang-postgresplsql">-- &#x67E5;&#x8BE2;&#x5E76;&#x6253;&#x5370;7839&#x7684;&#x59D3;&#x540D;&#x548C;&#x85AA;&#x6C34;
declare
  -- &#x5B9A;&#x4E49;&#x53D8;&#x91CF;&#x4FDD;&#x5B58;&#x59D3;&#x540D;&#x548C;&#x85AA;&#x6C34;
  --pename varchar2(20);
  --psal number;
  pename emp.ename%type;
  psal emp.sal%type;
begin
  -- &#x5F97;&#x5230;7839&#x7684;&#x59D3;&#x540D;&#x548C;&#x85AA;&#x6C34;
  select ename,sal into pename,psal from emp where empno=7839;
  -- &#x6253;&#x5370;
  dbms_output.put_line(pename||&apos;&#x7684;&#x85AA;&#x6C34;&#x662F;&apos;||psal);
end;
</code></pre>
<h3 id="&#x8BB0;&#x5F55;&#x53D8;&#x91CF;&#x5206;&#x91CF;&#x7684;&#x5F15;&#x7528;">&#x8BB0;&#x5F55;&#x53D8;&#x91CF;&#x5206;&#x91CF;&#x7684;&#x5F15;&#x7528;</h3>
<pre><code class="lang-postgresplsql">-- &#x67E5;&#x8BE2;&#x5E76;&#x4F46;&#x56E0;7839&#x7684;&#x59D3;&#x540D;&#x548C;&#x85AA;&#x6C34;
declare
  -- &#x5B9A;&#x4E49;&#x8BB0;&#x5F55;&#x578B;&#x53D8;&#x91CF;&#xFF1A;&#x4EE3;&#x8868;&#x4E00;&#x884C;
  emp_rec emp%rowtype;
begin
  select * into emp_rec from emp where empno=7839;
  dbms_output.put_line(emp_rec.ename||&apos;&#x7684;&#x85AA;&#x6C34;&#x662F;&apos;||emp_rec.sal);
end;
</code></pre>
<h3 id="&#x5E38;&#x91CF;&#x7684;&#x58F0;&#x660E;">&#x5E38;&#x91CF;&#x7684;&#x58F0;&#x660E;</h3>
<ol>
<li>&#x53EA;&#x9700;&#x5728;&#x58F0;&#x660E;&#x8BED;&#x53E5;&#x4E2D;&#xFF0C;&#x53D8;&#x91CF;&#x540D;&#x548C;&#x53D8;&#x91CF;&#x7C7B;&#x578B;&#x4E4B;&#x95F4;&#x52A0;&#x5165;constant&#x5373;&#x53EF;</li>
</ol>
<h2 id="if&#x8BED;&#x53E5;">IF&#x8BED;&#x53E5;</h2>
<h3 id="&#x8BED;&#x6CD5;1">&#x8BED;&#x6CD5;1</h3>
<pre><code class="lang-postgresplsql">IF &#x6761;&#x4EF6; THEN &#x8BED;&#x53E5;1;
&#x8BED;&#x53E5;2;
END IF;
</code></pre>
<h3 id="&#x8BED;&#x6CD5;2">&#x8BED;&#x6CD5;2</h3>
<pre><code class="lang-postgresplsql">IF &#x6761;&#x4EF6; THEN &#x8BED;&#x53E5;&#x5E8F;&#x5217;1;
ELSE &#x8BED;&#x53E5;&#x5E8F;&#x5217;2;
END IF;
</code></pre>
<h3 id="&#x8BED;&#x6CD5;3">&#x8BED;&#x6CD5;3</h3>
<pre><code class="lang-postgresplsql">IF &#x6761;&#x4EF6; THEN &#x8BED;&#x53E5;;
ELSIF &#x8BED;&#x53E5; THEN &#x8BED;&#x53E5;;
ELSE &#x8BED;&#x53E5;;
END IF;
</code></pre>
<h3 id="if&#x8BED;&#x53E5;&#x4F8B;">if&#x8BED;&#x53E5;&#x4F8B;</h3>
<pre><code class="lang-postgresplsql">-- &#x5224;&#x65AD;&#x7528;&#x6237;&#x4ECE;&#x952E;&#x76D8;&#x8F93;&#x5165;&#x7684;&#x6570;&#x5B57;
-- &#x63A5;&#x6536;&#x952E;&#x76D8;&#x8F93;&#x5165;
-- num: &#x5730;&#x5740;&#x503C;&#xFF0C;&#x5728;&#x8BE5;&#x5730;&#x5740;&#x4E0A;&#x4FDD;&#x5B58;&#x4E86;&#x8F93;&#x5165;&#x7684;&#x503C;
accept num prompt &apos;&#x8BF7;&#x8F93;&#x5165;&#x4E00;&#x4E2A;&#x6570;&#x5B57;:&apos;;
declare
  -- &#x5B9A;&#x4E49;&#x53D8;&#x91CF;&#x4FDD;&#x5B58;&#x6570;&#x5B57;
  pnum number := &amp;num;
begin
  if pnum = 0 then dbms_output.put_line(&apos;&#x4F60;&#x8F93;&#x5165;&#x7684;&#x662F;0&apos;);
     elsif pnum = 1 then dbms_output.put_line(&apos;&#x60A8;&#x8F93;&#x5165;&#x7684;&#x662F;1&apos;);
     elsif pnum = 2 then dbms_output.put_line(&apos;&#x60A8;&#x8F93;&#x5165;&#x7684;&#x662F;2&apos;);
     else dbms_output.put_line(&apos;&#x5176;&#x4ED6;&#x6570;&#x5B57;&apos;);
  end if;
end;
</code></pre>
<h2 id="&#x5FAA;&#x73AF;&#x8BED;&#x53E5;">&#x5FAA;&#x73AF;&#x8BED;&#x53E5;</h2>
<h3 id="&#x8BED;&#x6CD5;1">&#x8BED;&#x6CD5;1</h3>
<pre><code class="lang-postgresplsql">WHILE total &lt;= 25000
LOOP
...
total := total + salary;
END LOOP;
</code></pre>
<h3 id="&#x8BED;&#x6CD5;2">&#x8BED;&#x6CD5;2</h3>
<pre><code class="lang-postgresplsql">Loop
EXIT[when &#x6761;&#x4EF6;];
...
End loop;
</code></pre>
<h3 id="&#x8BED;&#x6CD5;3">&#x8BED;&#x6CD5;3</h3>
<pre><code class="lang-postgresplsql">FOR I IN 1..3
LOOP
&#x8BED;&#x53E5;&#x5E8F;&#x5217;;
END LOOP;
</code></pre>
<h3 id="&#x5FAA;&#x73AF;&#x5B9E;&#x4F8B;">&#x5FAA;&#x73AF;&#x5B9E;&#x4F8B;</h3>
<pre><code class="lang-postgresplsql">-- &#x6253;&#x5370;1-10
declare
  -- Local variables here
  pnum number :=1;
begin
  dbms_output.put_line(&apos;loop &#x5FAA;&#x73AF;&apos;);
  loop
    --&#x5FAA;&#x73AF;
    --&#x9000;&#x51FA;&#x6761;&#x4EF6;
    exit when pnum &gt; 10;
    dbms_output.put_line(pnum);
    --&#x52A0;1
    pnum := pnum + 1;
  end loop;
  dbms_output.put_line(&apos;while &#x5FAA;&#x73AF;&apos;);
  while pnum &lt; 20
    loop
      dbms_output.put_line(pnum);
      pnum := pnum + 1;
    end loop;
  dbms_output.put_line(&apos;for &#x5FAA;&#x73AF;&apos;);
  for i in 1..10
    loop
      dbms_output.put_line(i);
    end loop;
end;
</code></pre>
<h2 id="&#x5149;&#x6807;cursor--resultset">&#x5149;&#x6807;(Cursor) == ResultSet</h2>
<ol>
<li>&#x5149;&#x6807;&#x7684;&#x521D;&#x59CB;&#x4F4D;&#x7F6E;&#x4E3A;&#x5143;&#x7D20;&#x96C6;&#x5408;&#x4E2D;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;<h3 id="&#x8BF4;&#x660E;&#x5149;&#x6807;&#x8BED;&#x6CD5;&#xFF1A;">&#x8BF4;&#x660E;&#x5149;&#x6807;&#x8BED;&#x6CD5;&#xFF1A;</h3>
<pre><code class="lang-postgresplsql">CURSOR &#x5149;&#x6807;&#x540D; [(&#x53C2;&#x6570;&#x540D; &#x6570;&#x636E;&#x7C7B;&#x578B;[,&#x53C2;&#x6570;&#x540D;&#x3000;&#x6570;&#x636E;&#x7C7B;&#x578B;]...)]
 IS SELECT &#x8BED;&#x53E5;;
</code></pre>
</li>
</ol>
<h3 id="&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x5728;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#x7684;&#x8FD4;&#x56DE;&#x591A;&#x884C;&#x6570;&#x636E;">&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x5728;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#x7684;&#x8FD4;&#x56DE;&#x591A;&#x884C;&#x6570;&#x636E;</h3>
<p>&#x5B9A;&#x4E49;&#xFF1A; <code>pename emp.ename%type</code>;</p>
<pre><code class="lang-postgresplsql">cursor c1 is select ename from emp;
</code></pre>
<h3 id="&#x6253;&#x5F00;&#x5149;&#x6807;">&#x6253;&#x5F00;&#x5149;&#x6807;</h3>
<pre><code class="lang-postgresplsql">open c1;
</code></pre>
<h3 id="&#x5149;&#x6807;&#x7684;&#x5C5E;&#x6027;">&#x5149;&#x6807;&#x7684;&#x5C5E;&#x6027;</h3>
<ol>
<li><code>%isopen</code></li>
<li><code>%rowcount</code>(&#x5F71;&#x54CD;&#x7684;&#x884C;&#x6570;)</li>
<li><code>%found</code></li>
<li><code>%notfound</code></li>
</ol>
<h3 id="&#x53D6;&#x6D88;&#x4E00;&#x884C;&#x5149;&#x6807;&#x7684;&#x503C;&#x5230;&#x53D8;&#x91CF;&#x4E2D;">&#x53D6;&#x6D88;&#x4E00;&#x884C;&#x5149;&#x6807;&#x7684;&#x503C;&#x5230;&#x53D8;&#x91CF;&#x4E2D;</h3>
<pre><code class="lang-postgresplsql">fetch c1 into pename;
</code></pre>
<h3 id="&#x5173;&#x95ED;&#x5149;&#x6807;">&#x5173;&#x95ED;&#x5149;&#x6807;</h3>
<pre><code class="lang-postgresplsql">c1ose c1;
</code></pre>
<h3 id="&#x6E38;&#x6807;&#x7684;&#x7ED3;&#x675F;&#x65B9;&#x5F0F;">&#x6E38;&#x6807;&#x7684;&#x7ED3;&#x675F;&#x65B9;&#x5F0F;</h3>
<pre><code class="lang-postgresplsql">exit when c1%nofound;
</code></pre>
<h3 id="&#x4F8B;&#x5B50;">&#x4F8B;&#x5B50;</h3>
<pre><code class="lang-postgresplsql">-- &#x67E5;&#x8BE2;&#x5E76;&#x6253;&#x5370;&#x5458;&#x5DE5;&#x7684;&#x59D3;&#x540D;&#x548C;&#x85AA;&#x6C34;
/*
&#x5149;&#x6807;&#x7684;&#x5C5E;&#x6027;&#xFF1A;
%isopen
%rowcount(&#x5F71;&#x54CD;&#x7684;&#x884C;&#x6570;)
%found
%nofound
*/
declare
  -- &#x5B9A;&#x4E49;&#x5149;&#x6807;
  cursor cemp is select ename,sal from emp;
  pename emp.ename%type;
  psal emp.sal%type;
begin
  -- &#x6253;&#x5F00;&#x5149;&#x6807;
  open  cemp;
  loop
    --&#x53D6;&#x5F53;&#x524D;&#x8BB0;&#x5F55;
    fetch cemp into pename, psal;
    --&#x6CA1;&#x6709;&#x53D6;&#x5230;&#x8BB0;&#x5F55;&#xFF0C;&#x9000;&#x51FA;
    exit when cemp%notfound;
    dbms_output.put_line(pename||&apos;&#x7684;&#x85AA;&#x6C34;&#x662F;&apos;||psal);
  end loop;
  --&#x5173;&#x95ED;&#x5149;&#x6807;
  close cemp;
end;
</code></pre>
<h3 id="&#x6DA8;&#x5DE5;&#x8D44;&#xFF0C;&#x603B;&#x88C1;1000&#xFF0C;&#x7ECF;&#x7406;800&#xFF0C;&#x5176;&#x4ED6;400">&#x6DA8;&#x5DE5;&#x8D44;&#xFF0C;&#x603B;&#x88C1;1000&#xFF0C;&#x7ECF;&#x7406;800&#xFF0C;&#x5176;&#x4ED6;400</h3>
<pre><code class="lang-postgresplsql">-- &#x6DA8;&#x5DE5;&#x8D44;
declare
  -- &#x5B9A;&#x4E49;&#x5149;&#x6807;
  cursor cemp is select empno,job from emp;
  pempno emp.empno%type;
  pjob emp.job%type;

begin
  rollback;
  -- &#x6253;&#x5F00;&#x5149;&#x6807;
  open cemp;
  loop
    --&#x53D6;&#x4E00;&#x4E2A;&#x5458;&#x5DE5;
    fetch cemp into pempno,pjob;
    exit when cemp%notfound;
    --&#x5224;&#x65AD;&#x804C;&#x4F4D;
    if pjob = &apos;PRESIDENT&apos; then update emp set sal=sal+1000 where empno=pempno;
       elsif pjob = &apos;MANAGER&apos; then update emp set sal=sal+800 where empno=pempno;
       else update emp set sal=sal+400 where empno=pempno;
    end if;
  end loop;
  -- &#x5173;&#x95ED;&#x5149;&#x6807;
  close cemp;
  -- &#x63D0;&#x4EA4;
  commit;
  dbms_output.put_line(&apos;&#x5B8C;&#x6210;&apos;);
end;
</code></pre>
<h3 id="&#x5E26;&#x53C2;&#x6570;&#x7684;&#x5149;&#x6807;">&#x5E26;&#x53C2;&#x6570;&#x7684;&#x5149;&#x6807;</h3>
<pre><code class="lang-postgresplsql">-- &#x67E5;&#x8BE2;&#x67D0;&#x4E2A;&#x90E8;&#x95E8;&#x7684;&#x5458;&#x5DE5;&#x59D3;&#x540D;
declare
  cursor cemp(dno number) is select ename from emp where deptno=dno;
  pename emp.ename%type;
begin
  --&#x6253;&#x5F00;&#x5149;&#x6807;
  open cemp(10);
  loop
    fetch cemp into pename;
    exit when cemp%notfound;
    dbms_output.put_line(pename);
  end loop;
  --&#x5149;&#x6BD4;&#x5149;&#x6807;
  close cemp;
end;
</code></pre>
<h1 id="oracle&#x7684;&#x5F02;&#x5E38;&#x5904;&#x7406;">Oracle&#x7684;&#x5F02;&#x5E38;&#x5904;&#x7406;</h1>
<ol>
<li>&#x7CFB;&#x7EDF;&#x5B9A;&#x4E49;&#x4F8B;&#x5916;</li>
<li>&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x4F8B;&#x5916;<h2 id="&#x7CFB;&#x7EDF;&#x5B9A;&#x4E49;&#x4F8B;&#x5916;">&#x7CFB;&#x7EDF;&#x5B9A;&#x4E49;&#x4F8B;&#x5916;</h2>
|&#x7CFB;&#x7EDF;&#x5B9A;&#x4E49;&#x4F8B;&#x5916;|&#x8BF4;&#x660E;|
|---|---|
|No_data_found|&#x6CA1;&#x6709;&#x627E;&#x5230;&#x6570;&#x636E;|
|Too_many_rows|select...into&#x8BED;&#x53E5;&#x5339;&#x914D;&#x591A;&#x4E2A;&#x884C;|
|Zero_Divide|&#x88AB;&#x96F6;&#x9664;|
|Value_error|&#x7B97;&#x6570;&#x6216;&#x8F6C;&#x6362;&#x9519;&#x8BEF;|
|Timeout_on_resource|&#x5728;&#x7B49;&#x5F85;&#x8D44;&#x6E90;|</li>
</ol>
<h2 id="&#x4F8B;1&#xFF1A;&#x5199;&#x51FA;&#x88AB;0&#x9664;&#x7684;&#x5F02;&#x5E38;&#x7684;plsql&#x7A0B;&#x5E8F;">&#x4F8B;1&#xFF1A;&#x5199;&#x51FA;&#x88AB;0&#x9664;&#x7684;&#x5F02;&#x5E38;&#x7684;plsql&#x7A0B;&#x5E8F;</h2>
<pre><code class="lang-postgresplsql">-- &#x88AB;0&#x9664;
declare
  pnum number;
begin
  pnum := 1/0;
exception
  when zero_divide then dbms_output.put_line(&apos;1:0&#x4E0D;&#x80FD;&#x505A;&#x5206;&#x6BCD;&apos;);
                         dbms_output.put_line(&apos;2:0&#x4E0D;&#x80FD;&#x505A;&#x5206;&#x6BCD;&apos;);
  when value_error then dbms_output.put_line(&apos;&#x7B97;&#x672F;&#x6216;&#x8005;&#x8F6C;&#x6362;&#x9519;&#x8BEF;&apos;);
  when others then dbms_output.put_line(&apos;&#x5176;&#x4ED6;&#x4F8B;&#x5916;&apos;);
end;
</code></pre>
<h2 id="&#x4F8B;2&#xFF1A;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x4F8B;&#x5916;&#x4EE5;&#x53CA;&#x5904;&#x7406;&#x4F8B;&#x5916;">&#x4F8B;2&#xFF1A;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x4F8B;&#x5916;&#x4EE5;&#x53CA;&#x5904;&#x7406;&#x4F8B;&#x5916;</h2>
<ol>
<li>&#x4F7F;&#x7528;&#x51FD;&#x6570;<code>raise_application_error(errno,errmsg);</code><ol>
<li>errno&#x4E3A;&#x9519;&#x8BEF;&#x4EE3;&#x7801;&#xFF0C;&#x5728;&#x533A;&#x95F4;<code>-20000~-20999</code>&#x4E4B;&#x95F4;</li>
<li>errmsg&#x4E3A;&#x9519;&#x8BEF;&#x4FE1;&#x606F;</li>
</ol>
</li>
</ol>
<h2 id="&#x8FDB;&#x7A0B;&#x76D1;&#x89C6;&#x5668;&#x8FDB;&#x7A0B;pmon">&#x8FDB;&#x7A0B;&#x76D1;&#x89C6;&#x5668;&#x8FDB;&#x7A0B;(PMON)</h2>
<ol>
<li>&#x5728;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#x5931;&#x8D25;&#x65F6;&#x6267;&#x884C;&#x8FDB;&#x7A0B;&#x6062;&#x590D;<ol>
<li>&#x6E05;&#x695A;&#x6570;&#x636E;&#x7F13;&#x5B58;&#x533A;&#x544A;&#x8BC9;&#x7F13;&#x5B58;</li>
<li>&#x91CA;&#x653E;&#x8BE5;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#x4F7F;&#x7528;&#x7684;&#x8D44;&#x6E90;</li>
</ol>
</li>
<li>&#x76D1;&#x89C6;&#x4F1A;&#x8BDD;&#xFF0C;&#x67E5;&#x770B;&#x662F;&#x5426;&#x53D1;&#x751F;&#x7A7A;&#x95F2;&#x4F1A;&#x8BDD;&#x8D85;&#x65F6;</li>
<li>&#x5728;&#x76D1;&#x542C;&#x7A0B;&#x5E8F;&#x4E2D;&#x6CE8;&#x518C;&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;</li>
<li>&#x6240;&#x4EE5;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x5149;&#x6807;&#x56E0;&#x4E3A;&#x5F02;&#x5E38;&#x629B;&#x51FA;&#x800C;&#x6CA1;&#x6709;&#x5173;&#x95ED;&#xFF0C;&#x7531;PMON&#x6E05;&#x7406;</li>
</ol>
<h2 id="plsql&#x5B9E;&#x4F8B;">plsql&#x5B9E;&#x4F8B;</h2>
<h3 id="&#x5B9E;&#x4F8B;1&#xFF1A;&#x7EDF;&#x8BA1;&#x6BCF;&#x5E74;&#x5165;&#x804C;&#x7684;&#x5458;&#x5DE5;&#x4E2A;&#x6570;">&#x5B9E;&#x4F8B;1&#xFF1A;&#x7EDF;&#x8BA1;&#x6BCF;&#x5E74;&#x5165;&#x804C;&#x7684;&#x5458;&#x5DE5;&#x4E2A;&#x6570;</h3>
<h4 id="sql&#x8BED;&#x53E5;">SQL&#x8BED;&#x53E5;</h4>
<pre><code class="lang-oracle">SELECT to_char(hiredate,&apos;YYYY&apos;) from emp;
---&gt;&#x5149;&#x6807;---&gt;&#x5FAA;&#x73AF;---&gt;&#x9000;&#x51FA;&#x6761;&#x4EF6;:notfound;
</code></pre>
<h4 id="&#x53D8;&#x91CF;">&#x53D8;&#x91CF;</h4>
<ol>
<li>count80 number := 0;</li>
<li>count81 number := 0;</li>
<li>count82 number := 0;</li>
<li>count87 number := 0;</li>
</ol>
<h4 id="&#x4EE3;&#x7801;">&#x4EE3;&#x7801;</h4>
<pre><code class="lang-postgresplsql">/*
SQL&#x8BED;&#x53E5;

SELECT to_char(hiredate,&apos;YYYY&apos;) from emp;
---&gt;&#x5149;&#x6807;---&gt;&#x5FAA;&#x73AF;---&gt;&#x9000;&#x51FA;&#x6761;&#x4EF6;:notfound;

&#x53D8;&#x91CF;&#xFF1A;1&#x3001;&#x521D;&#x59CB;&#x503C; 2&#x3001;&#x6700;&#x7EC8;&#x5F97;&#x5230;
1. count80 number := 0;
2. count81 number := 0;
3. count82 number := 0;
4. count87 number := 0;
*/
declare
  -- &#x5165;&#x804C;&#x5E74;&#x4EFD;
  cursor cemp is select to_char(hiredate,&apos;yyyy&apos;) from emp;
  phiredate varchar2(4);
  --&#x6BCF;&#x5E74;&#x5165;&#x804C;&#x7684;&#x4EBA;&#x6570;
  count80 number := 0;
  count81 number := 0;
  count82 number := 0;
  count87 number := 0;
begin
  open cemp;
  loop
    -- &#x53D6;&#x4E00;&#x4E2A;&#x5458;&#x5DE5;&#x7684;&#x5165;&#x804C;&#x5E74;&#x4EFD;
    fetch cemp into phiredate;
    exit when cemp%notfound;
    -- &#x5224;&#x65AD;&#x5E74;&#x4EFD;
    if phiredate = &apos;1980&apos; then count80 := count80 + 1;
       elsif phiredate = &apos;1981&apos; then count81 := count81 + 1;
       elsif phiredate = &apos;1981&apos; then count81 := count82 + 1;
       else count87 := count87 + 1;
    end if;
  end loop;
  close cemp;
  --&#x8F93;&#x51FA;&#x7ED3;&#x679C;
  dbms_output.put_line(&apos;Total:&apos;||(count80+count81+count82+count87));
  dbms_output.put_line(&apos;1980:&apos;||count80);
  dbms_output.put_line(&apos;1981:&apos;||count81);
  dbms_output.put_line(&apos;1982:&apos;||count82);
  dbms_output.put_line(&apos;1987:&apos;||count87);
end;
</code></pre>
<h3 id="&#x5B9E;&#x4F8B;2">&#x5B9E;&#x4F8B;2</h3>
<ol>
<li>&#x4E3A;&#x5458;&#x5DE5;&#x6DA8;&#x5DE5;&#x8D44;&#x3002;&#x4ECE; &#x6700;&#x4F4E;&#x5DE5;&#x8D44;&#x8C03;&#x8D77;&#x6BCF;&#x4E2A;&#x4EBA;&#x6DA8;10%&#xFF0C;&#x4F46;&#x5DE5;&#x8D44;&#x603B;&#x989D;&#x4E0D;&#x80FD;&#x8D85;&#x8FC7;5&#x4E07;&#x5143;&#xFF0C;&#x8BF7;&#x8BA1;&#x7B97;&#x6DA8;&#x5DE5;&#x8D44;&#x4EBA;&#x6570;&#x548C;&#x6DA8;&#x5DE5;&#x8D44;&#x540E;&#x7684;&#x5DE5;&#x8D44;&#x603B;&#x989D;&#xFF0C;&#x5E76;&#x8F93;&#x51FA;&#x6DA8;&#x5DE5;&#x8D44;&#x4EBA;&#x6570;&#x4EE5;&#x53CA;&#x5DE5;&#x8D44;&#x603B;&#x6570;<h4 id="sql&#x8BED;&#x53E5;">SQL&#x8BED;&#x53E5;</h4>
<pre><code class="lang-oracle">select empno, sal from emp order by sal;
---&gt;&#x5149;&#x6807;---&gt;&#x5FAA;&#x73AF;---&gt;&#x9000;&#x51FA;&#x6761;&#x4EF6;:1. &#x5DE5;&#x8D44;&#x603B;&#x989D;&gt;5W 2.notfound 3. &#x4E0B;&#x4E00;&#x4E2A;&#x5458;&#x5DE5;&#x6DA8;&#x5DE5;&#x8D44;&#x540E;&#x8D85;&#x8FC7;&#x4E86;&#x9650;&#x989D;&#xFF0C;&#x4E0D;&#x6DA8;
</code></pre>
<h4 id="&#x53D8;&#x91CF;">&#x53D8;&#x91CF;</h4>
</li>
<li>&#x6DA8;&#x5DE5;&#x8D44;&#x7684;&#x4EBA;&#x6570;&#xFF1A;countEmp number := 0;</li>
<li>&#x6DA8;&#x540E;&#x7684;&#x5DE5;&#x8D44;&#x603B;&#x989D;&#xFF1A;salTotal number;<ol>
<li>select sum(sal) into salTotal from emp;</li>
<li>&#x6DA8;&#x540E;=&#x6DA8;&#x524D;+sal*0.1</li>
</ol>
</li>
</ol>
<h4 id="&#x4EE3;&#x7801;">&#x4EE3;&#x7801;</h4>
<pre><code class="lang-postgresplsql">/*
1. &#x4E3A;&#x5458;&#x5DE5;&#x6DA8;&#x5DE5;&#x8D44;&#x3002;&#x4ECE; &#x6700;&#x4F4E;&#x5DE5;&#x8D44;&#x8C03;&#x8D77;&#x6BCF;&#x4E2A;&#x4EBA;&#x6DA8;10%&#xFF0C;&#x4F46;&#x5DE5;&#x8D44;&#x603B;&#x989D;&#x4E0D;&#x80FD;&#x8D85;&#x8FC7;5&#x4E07;&#x5143;&#xFF0C;&#x8BF7;&#x8BA1;&#x7B97;&#x6DA8;&#x5DE5;&#x8D44;&#x4EBA;&#x6570;&#x548C;&#x6DA8;&#x5DE5;&#x8D44;&#x540E;&#x7684;&#x5DE5;&#x8D44;&#x603B;&#x989D;&#xFF0C;&#x5E76;&#x8F93;&#x51FA;&#x6DA8;&#x5DE5;&#x8D44;&#x4EBA;&#x6570;&#x4EE5;&#x53CA;&#x5DE5;&#x8D44;&#x603B;&#x6570;
SQL&#x8BED;&#x53E5;
select empno, sal from emp order by sal;
---&gt;&#x5149;&#x6807;---&gt;&#x5FAA;&#x73AF;---&gt;&#x9000;&#x51FA;&#x6761;&#x4EF6;:1. &#x5DE5;&#x8D44;&#x603B;&#x989D;&gt;5W 2.notfound


1. &#x6DA8;&#x5DE5;&#x8D44;&#x7684;&#x4EBA;&#x6570;&#xFF1A;countEmp number := 0;
2. &#x6DA8;&#x540E;&#x7684;&#x5DE5;&#x8D44;&#x603B;&#x989D;&#xFF1A;salTotal number;
    1. select sum(sal) into salTotal from emp;
    2. &#x6DA8;&#x540E;=&#x6DA8;&#x524D;+sal*0.1
*/
declare
  cursor cemp is select empno, sal from emp order by sal;
  pempno emp.empno%type;
  psal emp.sal%type;
  -- &#x6DA8;&#x5DE5;&#x8D44;&#x7684;&#x4EBA;&#x6570;
  countEmp number := 0;
  -- &#x6DA8;&#x5DE5;&#x8D44;&#x603B;&#x989D;;
  salTotal number;
begin
  -- &#x5F97;&#x5230;&#x521D;&#x59CB;&#x5316;&#x7684;&#x5DE5;&#x8D44;&#x603B;&#x989D;
  select sum(sal) into salTotal from emp;
  open cemp;
  loop
    --1&#x3001;&#x603B;&#x989D;&gt;5W
    exit when salTotal &gt; 80000;
    --&#x53D6;&#x4E00;&#x4E2A;&#x5458;&#x5DE5;&#x6DA8;&#x5DE5;&#x8D44;
    fetch cemp into pempno, psal;
    --&#x4E0B;&#x4E00;&#x4E2A;&#x5458;&#x5DE5;&#x5DE5;&#x8D44;&#x6DA8;&#x4E86;&#x4E4B;&#x540E;&#x8D85;&#x51FA;&#x9884;&#x7B97;&#xFF0C;&#x9000;&#x51FA;
    exit when (salTotal + psal*0.1) &gt; 80000;
    --2&#x3001;notfound
    exit when cemp%notfound;
    --&#x6DA8;&#x5DE5;&#x8D44;
    update emp set sal=sal*1.1 where empno=pempno;
    --&#x4EBA;&#x6570;+1
    countEmp := countEmp + 1;
    --2.&#x6DA8;&#x540E;=&#x6DA8;&#x524D;+sal*0.1
    salTotal := salTotal + psal*0.1;
  end loop;
  close cemp;
  commit;
  dbms_output.put_line(&apos;&#x6DA8;&#x540E;&#x7684;&#x5DE5;&#x8D44;&#x603B;&#x989D;&#xFF1A;&apos;||salTotal||&apos;&#x6DA8;&#x5DE5;&#x8D44;&#x7684;&#x4EBA;&#x6570;&#xFF1A;&apos;||countEmp);
end;
</code></pre>
<h3 id="&#x5B9E;&#x4F8B;3">&#x5B9E;&#x4F8B;3</h3>
<ol>
<li><p>&#x7528;PL/SQL&#x8BED;&#x8A00;&#x7F16;&#x5199;&#x4E00;&#x7A0B;&#x5E8F;&#xFF0C;&#x5B9E;&#x73B0;&#x6309;&#x90E8;&#x95E8;&#x5206;&#x6BB5;(6000&#x4EE5;&#x4E0A;&#x3001;(6000,3000)&#x3001;3000&#x5143;&#x4E00;&#x4E0B;)&#x7EDF;&#x8BA1;&#x5404;&#x5DE5;&#x8D44;&#x6BB5;&#x7684;&#x804C;&#x5DE5;&#x4EBA;&#x6570;&#x3001;&#x4EE5;&#x53CA;&#x5404;&#x90E8;&#x95E8;&#x7684;&#x5DE5;&#x8D44;&#x603B;&#x989D;(&#x5DE5;&#x8D44;&#x603B;&#x989D;&#x4E0D;&#x5305;&#x542B;&#x5956;&#x91D1;)&#xFF0C;&#x53C2;&#x8003;&#x5982;&#x4E0B;&#x683C;&#x5F0F;&#xFF1A;
<img src="format1.png" alt=""></p>
</li>
<li><p>&#x521B;&#x5EFA;&#x4E00;&#x5F20;&#x8868;&#x7528;&#x4E8E;&#x4FDD;&#x5B58;&#x6570;&#x636E;</p>
<pre><code class="lang-oracle">create table msg1
(
deptno number,
emp_num1 number,
emp_num2 number,
emp_num3 number.
sum_sal number
);
</code></pre>
</li>
</ol>
<h4 id="sql&#x8BED;&#x53E5;">SQL&#x8BED;&#x53E5;</h4>
<ol>
<li>&#x90E8;&#x95E8;&#xFF1A;<code>select deptno from dept;</code></li>
<li>&#x67E5;&#x90E8;&#x95E8;&#x4E2D;&#x7684;&#x5458;&#x5DE5;&#x85AA;&#x6C34;&#xFF1A;<code>select sal from emp where deptno=??</code></li>
</ol>
<h4 id="&#x53D8;&#x91CF;">&#x53D8;&#x91CF;</h4>
<ol>
<li>&#x6BCF;&#x4E2A;&#x6BB5;&#x7684;&#x4EBA;&#x6570;<ol>
<li>count1 number;</li>
<li>count2 number;</li>
<li>count3 number;</li>
</ol>
</li>
<li>&#x90E8;&#x95E8;&#x7684;&#x5DE5;&#x8D44;&#x603B;&#x989D;&#xFF1A;salTotal number := 0;<ol>
<li><code>select sum(sal) into salTotal from emp where deptno=??</code></li>
<li>&#x7D2F;&#x52A0;</li>
</ol>
</li>
<li>&#x5B58;&#x50A8;&#x5149;&#x6807;&#x53D6;&#x51FA;&#x7684;&#x503C;<ol>
<li>&#x90E8;&#x95E8;&#x53F7;&#xFF1A;pdeptno dept.deptno%type;</li>
<li>&#x5DE5;&#x8D44;&#xFF1A;psal emp.sal%type;</li>
</ol>
</li>
</ol>
<pre><code class="lang-postgresplsql">/*
SQL&#x8BED;&#x53E5;
1. &#x90E8;&#x95E8;&#xFF1A;`select deptno from dept;`
2. &#x67E5;&#x90E8;&#x95E8;&#x4E2D;&#x7684;&#x5458;&#x5DE5;&#x85AA;&#x6C34;&#xFF1A;`select sal from emp where deptno=??`
&#x53D8;&#x91CF;
1. &#x6BCF;&#x4E2A;&#x6BB5;&#x7684;&#x4EBA;&#x6570;
    1. count1 number;
    2. count2 number;
    3. count3 number;
2. &#x90E8;&#x95E8;&#x7684;&#x5DE5;&#x8D44;&#x603B;&#x989D;&#xFF1A;salTotal number := 0;
    1. `select sum(sal) into salTotal from emp where deptno=??`
    2. &#x7D2F;&#x52A0;
*/
declare
  -- &#x5916;&#x5FAA;&#x73AF;&#x5149;&#x6807;
  cursor cdeptno is select deptno from dept;
  -- &#x5185;&#x5FAA;&#x73AF;&#x5149;&#x6807;
  cursor csal(dno number) is select sal from emp where deptno=dno;
  --&#x6BCF;&#x4E2A;&#x6BB5;&#x7684;&#x4EBA;&#x6570;
  count1 number := 0;
  count2 number := 0;
  count3 number := 0;
  --&#x90E8;&#x95E8;&#x5DE5;&#x8D44;&#x603B;&#x989D;
  salTotal number := 0;
  --&#x5B58;&#x50A8;&#x5149;&#x6807;&#x53D6;&#x51FA;&#x7684;&#x503C;
  pdeptno dept.deptno%type;
  psal emp.sal%type;
begin
  -- &#x6253;&#x5F00;&#x5916;&#x5149;&#x6807;
  open cdeptno;
  loop
    --&#x6E05;&#x7A7A;&#x7EDF;&#x8BA1;&#x6570;&#x91CF;
    count1 := 0;
    count2 := 0;
    count3 := 0;
    --&#x6E05;&#x7A7A;&#x90E8;&#x95E8;&#x5DE5;&#x8D44;&#x603B;&#x989D;
    salTotal := 0;
    --&#x4ECE;&#x5916;&#x5149;&#x6807;&#x53D6;&#x51FA;&#x90E8;&#x95E8;&#x53F7;
    fetch cdeptno into pdeptno;
    exit when cdeptno%notfound;
    --&#x6253;&#x5F00;&#x5185;&#x5149;&#x6807;
    open csal(pdeptno);
    loop
      fetch csal into psal;
      exit when csal%notfound;
      if psal &lt; 3000 then count1 := count1 + 1;
         elsif psal &lt; 6000 then count2 := count2 + 1;
         else count3 := count3 + 1;
      end if;
      salTotal := salTotal + psal;
    end loop;
    close csal;
    dbms_output.put_line(&apos;outer&apos;);
    insert into msg1 values(pdeptno,count1,count2,count3,salTotal);
  end loop;
  close cdeptno;
  commit;
  dbms_output.put_line(&apos;&#x5B8C;&#x6210;&apos;);
end;
</code></pre>
<h1 id="&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x548C;&#x5B58;&#x50A8;&#x51FD;&#x6570;">&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x548C;&#x5B58;&#x50A8;&#x51FD;&#x6570;</h1>
<ol>
<li>&#x6307;&#x5B58;&#x50A8;&#x5728;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x4F9B;&#x6240;&#x6709;&#x7528;&#x6237;&#x7A0B;&#x5E8F;&#x8C03;&#x7528;&#x7684;&#x5B50;&#x7A0B;&#x5E8F;&#x53EB;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x3001;&#x5B58;&#x50A8;&#x51FD;&#x6570;&#x3002;</li>
<li>&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x4E0D;&#x80FD;&#x901A;&#x8FC7;return&#x5B50;&#x53E5;&#x8FD4;&#x56DE;&#x51FD;&#x6570;&#x503C;</li>
<li>&#x5B58;&#x50A8;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;return&#x5B50;&#x53E5;&#x8FD4;&#x56DE;&#x51FD;&#x6570;&#x503C;</li>
<li>&#x4E00;&#x822C;&#x4E0D;&#x5728;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x548C;&#x5B58;&#x50A8;&#x51FD;&#x6570;&#x63D0;&#x4EA4;&#x6216;&#x8005;&#x56DE;&#x6EDA;</li>
</ol>
<h2 id="&#x521B;&#x5EFA;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;">&#x521B;&#x5EFA;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;</h2>
<ol>
<li>&#x7528;<code>CREATE PROCEDURE</code>&#x547D;&#x4EE4;&#x5EFA;&#x7ACB;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;</li>
<li>&#x8BED;&#x6CD5;&#xFF1A;<pre><code class="lang-postgresplsql">create [or replace] PROCEDURE &#x8FC7;&#x7A0B;&#x540D;(&#x53C2;&#x6570;&#x5217;&#x8868;)
AS|IS
 PLSQL&#x5B50;&#x7A0B;&#x5E8F;&#x4F53;;
</code></pre>
</li>
</ol>
<h2 id="&#x8C03;&#x7528;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;">&#x8C03;&#x7528;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;</h2>
<ol>
<li>&#x8BED;&#x6CD5;&#xFF1A;<pre><code class="lang-oracle">exec procedure_name();
--&#x6216;&#x8005;
begin
 procedure_name();
 procedure_name();
end;
</code></pre>
</li>
</ol>
<h2 id="&#x5220;&#x9664;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;">&#x5220;&#x9664;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;</h2>
<ol>
<li>&#x8BED;&#x6CD5;:<pre><code class="lang-oracle">drop procedure procedure_name;
</code></pre>
</li>
</ol>
<h2 id="&#x4F8B;">&#x4F8B;</h2>
<pre><code class="lang-postgresplsql">create or replace procedure raiseSalary(eno in number)
as
  --&#x5B9A;&#x4E49;&#x53D8;&#x91CF;&#x4FDD;&#x5B58;&#x6DA8;&#x524D;&#x7684;&#x85AA;&#x6C34;
  psal emp.sal%type;
begin
  --&#x5F97;&#x5230;&#x6DA8;&#x524D;&#x7684;&#x85AA;&#x6C34;
  select sal into psal from emp where empno=eno;
  --&#x6DA8;100
  update emp set sal=sal+100 where empno=eno;
  dbms_output.put_line(&apos;&#x6DA8;&#x524D;&#xFF1A;&apos;||psal||&apos;&#x6DA8;&#x540E;&#xFF1A;&apos;||(psal+100));
end;
</code></pre>
<h2 id="&#x521B;&#x5EFA;&#x5B58;&#x50A8;&#x51FD;&#x6570;">&#x521B;&#x5EFA;&#x5B58;&#x50A8;&#x51FD;&#x6570;</h2>
<ol>
<li>&#x51FD;&#x6570;(Function)&#x4E3A;&#x4E00;&#x547D;&#x540D;&#x7684;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#xFF0C;&#x53EF;&#x5F85;&#x53C2;&#x6570;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x8BA1;&#x7B97;&#x503C;&#xFF0C;&#x51FD;&#x6570;&#x548C;&#x8FC7;&#x7A0B;&#x7684;&#x7ED3;&#x6784;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x5FC5;&#x987B;&#x6709;&#x4E00;&#x4E2A;<code>RETURN</code>&#x5B50;&#x53E5;&#xFF0C;&#x7528;&#x4E8E;&#x8FD4;&#x56DE;&#x51FD;&#x6570;&#x503C;&#x3002;&#x51FD;&#x6570;&#x8BF4;&#x660E;&#x8981;&#x6307;&#x5B9A;&#x51FD;&#x6570;&#x540D;&#x3001;&#x7ED3;&#x679C;&#x503C;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x4EE5;&#x53CA;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x7B49;&#x3002;</li>
<li>&#x5EFA;&#x7ACB;&#x5B58;&#x50A8;&#x51FD;&#x6570;&#x7684;&#x8BED;&#x6CD5;&#xFF1A;<pre><code class="lang-oracle">create [or replace] function &#x51FD;&#x6570;&#x540D;(&#x53C2;&#x6570;&#x5217;&#x8868;)
RETURN &#x51FD;&#x6570;&#x503C;&#x7C7B;&#x578B;
AS
 PLSQL&#x5B50;&#x7A0B;&#x5E8F;&#x4F53;;
</code></pre>
</li>
</ol>
<h2 id="&#x5220;&#x9664;&#x5B58;&#x50A8;&#x51FD;&#x6570;">&#x5220;&#x9664;&#x5B58;&#x50A8;&#x51FD;&#x6570;</h2>
<ol>
<li>&#x8BED;&#x6CD5;&#xFF1A;<pre><code class="lang-oracle">drop function function_name;
</code></pre>
</li>
</ol>
<h3 id="&#x67E5;&#x8BE2;&#x67D0;&#x4E2A;&#x5458;&#x5DE5;&#x7684;&#x5E74;&#x6536;&#x5165;">&#x67E5;&#x8BE2;&#x67D0;&#x4E2A;&#x5458;&#x5DE5;&#x7684;&#x5E74;&#x6536;&#x5165;</h3>
<pre><code class="lang-postgresplsql">create or replace function queryEmpIncome(eno in number)
return number
as
    --&#x6708;&#x85AA;&#x548C;&#x5956;&#x91D1;
    psal emp.sal%type;
    pcomm emp.comm%type;
begin
    --&#x5F97;&#x5230;&#x6708;&#x85AA;&#x548C;&#x5956;&#x91D1;
    select sal,comm into psal,pcomm from emp where empno=eno;
    --&#x8FD4;&#x56DE;&#x5E74;&#x6536;&#x5165;
    return psal*12+nvl(pcomm,0);
end;
</code></pre>
<h3 id="&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;">&#x7ED1;&#x5B9A;&#x53D8;&#x91CF;</h3>
<ol>
<li><code>:result</code></li>
</ol>
<h2 id="&#x8FC7;&#x7A0B;&#x548C;&#x51FD;&#x6570;&#x4E2D;&#x7684;in&#x548C;out">&#x8FC7;&#x7A0B;&#x548C;&#x51FD;&#x6570;&#x4E2D;&#x7684;in&#x548C;out</h2>
<ol>
<li>&#x4E00;&#x822C;&#x6765;&#x8BB2;&#xFF0C;&#x8FC7;&#x7A0B;&#x548C;&#x51FD;&#x6570;&#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x6709;&#x4E00;&#x4E2A;&#x8FD4;&#x56DE;&#x503C;&#xFF1B;&#x800C;&#x8FC7;&#x7A0B;&#x6CA1;&#x6709;&#x8FD4;&#x56DE;&#x503C;</li>
<li>&#x4F46;&#x8FC7;&#x7A0B;&#x548C;&#x51FD;&#x6570;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;out&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x8F93;&#x51FA;&#x53C2;&#x6570;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;out&#x53C2;&#x6570;&#xFF0C;&#x5728;&#x8FC7;&#x7A0B;&#x548C;&#x51FD;&#x6570;&#x4E2D;&#x5B9E;&#x73B0;&#x8FD4;&#x56DE;&#x591A;&#x4E2A;&#x503C;</li>
</ol>
<h3 id="&#x5728;out&#x53C2;&#x6570;&#x4E2D;&#x4F7F;&#x7528;&#x6E38;&#x6807;">&#x5728;out&#x53C2;&#x6570;&#x4E2D;&#x4F7F;&#x7528;&#x6E38;&#x6807;</h3>
<p>&#x95EE;&#x9898;&#xFF1A;&#x67E5;&#x8BE2;&#x67D0;&#x4E2A;&#x90E8;&#x95E8;&#x4E2D;&#x6240;&#x6709;&#x5458;&#x5DE5;&#x7684;&#x6240;&#x6709;&#x4FE1;&#x606F;</p>
<ul>
<li>&#x58F0;&#x660E;&#x5305;&#x7ED3;&#x6784;<pre><code class="lang-oracle">CREATE OR REPLACE PACKAGE MYPACKAGE AS
  type empcursor is ref cursor
  procedure queryEmpList(dno in number, empList, empList out empcursor);
END MYPACKAGE;
</code></pre>
</li>
<li>&#x521B;&#x5EFA;&#x5305;&#x4F53;<pre><code class="lang-oracle">CREATE OR REPLACE PACKAGE BODY MYPACKAGE AS
  procedure queryEmpList(dno in number, empList out empcursor) AS
  BEGIN
      open empList for select * from emp where deptno=dno;
  END queryEmpList;
END MYPACKAGE;
</code></pre>
</li>
</ul>
<h2 id="&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x5B58;&#x50A8;&#x51FD;&#x6570;">&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;/&#x5B58;&#x50A8;&#x51FD;&#x6570;</h2>
<ol>
<li>&#x539F;&#x5219;&#xFF1A;&#x5982;&#x679C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x7528;&#x5B58;&#x50A8;&#x51FD;&#x6570;&#xFF1B;&#x5426;&#x5219;&#xFF0C;&#x5C31;&#x7528;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;</li>
</ol>
<h1 id="&#x89E6;&#x53D1;&#x5668;">&#x89E6;&#x53D1;&#x5668;</h1>
<ol>
<li>&#x6570;&#x636E;&#x5E93;&#x89E6;&#x53D1;&#x5668;&#x662F;&#x4E00;&#x4E2A;&#x4E0E;&#x8868;&#x76F8;&#x5173;&#x8054;&#x7684;&#x3001;&#x5B58;&#x50A8;&#x7684;PL/SQL&#x7A0B;&#x5E8F;&#x3002;&#x6BCF;&#x5F53;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#x8BED;&#x53E5;(Insert,update,delete)&#x5728;&#x6307;&#x5B9A;&#x7684;&#x8868;&#x4E0A;&#x53D1;&#x51FA;&#x65F6;&#xFF0C;Oracle&#x81EA;&#x52A8;&#x5730;&#x6267;&#x884C;&#x89E6;&#x53D1;&#x5668;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x8BED;&#x53E5;&#x5E8F;&#x5217;&#x3002;</li>
</ol>
<h2 id="&#x89E6;&#x53D1;&#x5668;&#x7C7B;&#x578B;">&#x89E6;&#x53D1;&#x5668;&#x7C7B;&#x578B;</h2>
<ol>
<li><p>&#x8BED;&#x53E5;&#x89E6;&#x53D1;&#x5668;</p>
<ol>
<li>&#x5728;&#x6307;&#x5B9A;&#x7684;&#x64CD;&#x4F5C;&#x8BED;&#x53E5;&#x64CD;&#x4F5C;&#x4E4B;&#x524D;&#x6216;&#x4E4B;&#x540E;&#x6267;&#x884C;&#x4E00;&#x6B21;&#xFF0C;&#x4E0D;&#x7BA1;&#x8FD9;&#x6761;&#x8BED;&#x53E5;&#x5F71;&#x54CD;&#x4E86;&#x591A;&#x5C11;&#x884C;&#x3002;</li>
</ol>
</li>
<li><p>&#x884C;&#x89E6;&#x53D1;&#x5668;(FOR EACH ROW)</p>
<ol>
<li>&#x89E6;&#x53D1;&#x8BED;&#x53E5;&#x4F5C;&#x7528;&#x7684;&#x6BCF;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x90FD;&#x88AB;&#x9664;&#x6CD5;&#x3002;&#x5728;&#x884C;&#x7EA7;&#x89E6;&#x53D1;&#x5668;&#x4E2D;&#x4F7F;&#x7528;<code>:old</code>&#x548C;<code>:new</code>&#x4F2A;&#x8BB0;&#x5F55;&#x53D8;&#x91CF;&#xFF0C;&#x8BC6;&#x522B;&#x503C;&#x7684;&#x72B6;&#x6001;&#x3002;</li>
</ol>
</li>
</ol>
<h2 id="&#x89E6;&#x53D1;&#x5668;&#x7684;&#x4F5C;&#x7528;">&#x89E6;&#x53D1;&#x5668;&#x7684;&#x4F5C;&#x7528;</h2>
<ol>
<li>&#x6570;&#x636E;&#x786E;&#x8BA4;</li>
<li>&#x5B9E;&#x65BD;&#x590D;&#x6742;&#x7684;&#x5B89;&#x5168;&#x6027;&#x68C0;&#x67E5;</li>
<li>&#x505A;&#x5BA1;&#x8BA1;&#xFF0C;&#x8DDF;&#x8E2A;&#x8868;&#x4E0A;&#x6240;&#x505A;&#x7684;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#x7B49;</li>
<li>&#x6570;&#x636E;&#x7684;&#x5907;&#x4EFD;&#x548C;&#x540C;&#x6B65;</li>
</ol>
<h2 id="&#x67E5;&#x8BE2;&#x89E6;&#x53D1;&#x5668;&#x3001;&#x8FC7;&#x7A0B;&#x53CA;&#x51FD;&#x6570;">&#x67E5;&#x8BE2;&#x89E6;&#x53D1;&#x5668;&#x3001;&#x8FC7;&#x7A0B;&#x53CA;&#x51FD;&#x6570;</h2>
<pre><code class="lang-oracle">--&#x67E5;&#x8BE2;&#x7528;&#x6237;&#x89E6;&#x53D1;&#x5668;
select * from user_triggers;
--&#x67E5;&#x8BE2;&#x7528;&#x6237;&#x8FC7;&#x7A0B;&#x53CA;&#x51FD;&#x6570;
select * from user_source;
</code></pre>
<h2 id="&#x521B;&#x5EFA;&#x89E6;&#x53D1;&#x5668;">&#x521B;&#x5EFA;&#x89E6;&#x53D1;&#x5668;</h2>
<pre><code class="lang-oracle">CREATE [or REPLACE] TRIGGER &#x89E6;&#x53D1;&#x5668;&#x540D;
{BEFORE|AFTER}
{DELETE|INSERT|UPDATE[OF &#x5217;&#x540D;]}
ON &#x8868;&#x540D;
[FOR EACH ROW [WHEN(&#x6761;&#x4EF6;)]]
PLSQL&#x7A0B;&#x5E8F;&#x5757;
</code></pre>
<h2 id="&#x89E6;&#x53D1;&#x8BED;&#x53E5;&#x4E0E;&#x4F2A;&#x8BB0;&#x5F55;&#x53D8;&#x91CF;&#x7684;&#x503C;">&#x89E6;&#x53D1;&#x8BED;&#x53E5;&#x4E0E;&#x4F2A;&#x8BB0;&#x5F55;&#x53D8;&#x91CF;&#x7684;&#x503C;</h2>
<table>
<thead>
<tr>
<th>&#x89E6;&#x53D1;&#x5668;&#x8BED;&#x53E5;</th>
<th>:old</th>
<th>:new</th>
</tr>
</thead>
<tbody>
<tr>
<td>Insert</td>
<td>&#x6240;&#x6709;&#x5B57;&#x6BB5;&#x90FD;&#x662F;&#x7A7A;(null)</td>
<td>&#x5C06;&#x8981;&#x63D2;&#x5165;&#x7684;&#x6570;&#x636E;</td>
</tr>
<tr>
<td>Update</td>
<td>&#x66F4;&#x65B0;&#x4EE5;&#x524D;&#x8BE5;&#x884C;&#x7684;&#x503C;</td>
<td>&#x66F4;&#x65B0;&#x540E;&#x7684;&#x503C;</td>
</tr>
<tr>
<td>delete</td>
<td>&#x5220;&#x9664;&#x4EE5;&#x524D;&#x8BE5;&#x884C;&#x7684;&#x503C;</td>
<td>&#x6240;&#x6709;&#x5B57;&#x6BB5;&#x90FD;&#x662F;&#x7A7A;(null)</td>
</tr>
</tbody>
</table>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="day26.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: day26">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"day27","level":"1.4.3","depth":2,"previous":{"title":"day26","level":"1.4.2","depth":2,"path":"note/Oracle/day26.md","ref":"./note/Oracle/day26.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["toggle-chapters","multipart","disqus","livereload"],"pluginsConfig":{"disqus":{"useIdentifier":false,"shortName":"introducetogitbook"},"livereload":{},"search":{},"multipart":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"toggle-chapters":{}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"note/Oracle/day27.md","mtime":"2018-07-16T10:03:48.237Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-07-16T10:10:23.914Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-toggle-chapters/toggle.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

